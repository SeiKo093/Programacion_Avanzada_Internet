<<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Practica Canvas5, CruzMorenoJesusEnrique</title>
  </head>

  <body style="background-color: rgb(214, 214, 214)">
    <center><canvas id="canvas01" width="600" height="600"> </canvas></center>
  </body>

  <script>
    window.requestAnimationFrame = (function () {
      return (
        window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        function (callback) {
          window.setTimeout(callback, 17);
        }
      );
    })();
    window.requestAnimationFrame(update);

    var canvas = document.getElementById("canvas01");
    var ctx = canvas.getContext("2d");

    var col;
    var dir;
    var x = 275;
    var y = 275;

    class Jugador {
      constructor(w, h) {
        this.x = 275;
        this.y = 275;
        this.w = w;
        this.h = h;
        this.speed = 8;
      }

      pintar(ctx) {
        ctx.fillStyle = random_rgba();
        ctx.fillRect(this.x, this.y, this.w, this.h);
      }
    }

    class Obstaculo {
      constructor(x, y, w, h) {
        this.x = x;
        this.y = y;
        this.w = w;
        this.h = h;
      }

      pintar(ctx) {
        ctx.fillStyle = "#333333";
        ctx.fillRect(this.x, this.y, this.w, this.h);
      }

      playerCollider(personaje) {
        if (
            this.x < personaje.x + personaje.w  &&  
                this.x + this.w > personaje.x &&    
                this.y < personaje.y + personaje.h &&    
                this.y + this.h> personaje.y
        ) {
          console.log("Chin me pegue!");
          switch (dir) {
            case 0:
              personaje.y += personaje.speed * 2;
              break;

            case 1:
              personaje.y -= personaje.speed * 2;
              break;

            case 2:
              personaje.x -= personaje.speed * 2;
              break;

            case 3:
              personaje.x += personaje.speed * 2;
              //console.log("AAAA");
              break;

            default:
              break;
          }
          dir = 4;
          return true;
        }
        return false;
      }
    }

    class Bono {
      constructor(w, h) {
        this.x = 380;
        this.y = 380;
        this.w = w;
        this.h = h;
      }

      pintar(ctx) {
        ctx.fillStyle = "red";
        ctx.fillRect(this.x, this.y, this.w, this.h);
      }

      randompos() {
        this.x = Math.floor(Math.random() * 590);
        this.y = Math.floor(Math.random() * 590);
      }

      playerCollider(personaje) {
        if (
            this.x < personaje.x + personaje.w  &&  
                this.x + this.w > personaje.x &&    
                this.y < personaje.y + personaje.h &&    
                this.y + this.h> personaje.y
        ) {
          console.log("Chin me Comieron!");
          personaje.speed += 1;
          return true;
        }
        return false;
      }
    }

    function random_rgba() {
      var o = Math.round, r = Math.random, s = 255;
      return ( "rgba(" + o(r() * s) + "," + o(r() * s) + "," + o(r() * s) + "," + r().toFixed(1) + ")");
    }


    //JUGADOR
    var pj = new Jugador(40,40);
    var bonito = new Bono(30,30);

    var pared01 = new Obstaculo(125,150,100,15);
    var pared02 = new Obstaculo(200,500,220,25);

    var pausa = false; var score = 0;
    document.addEventListener("keydown", (event) => {
      switch (event.keyCode) {
        case 87:
          dir = 0;
          //y -= 8;
          break;

        case 83:
          dir = 1;
          //y += 8;
          break;

        case 68:
          dir = 2;
          //x += 8;
          break;

        case 65:
          dir = 3;
          //x -= 8;
          break;

          case 27:
          if (!pausa) {
              pausa = true;
            }else{
              pausa = false;
            }
            break;
        default:
          break;
      }

      // repaint();
    });

    function update() {
      if(!pausa){
        switch (dir) {
        case 0:
          pj.y -= pj.speed;
          if (pj.y < -50) {
            pj.y = 620;
          }
          break;

        case 1:
        pj.y += pj.speed;
          if (pj.y > 620) {
            pj.y = -50;
          }
          break;

        case 2:
        pj.x += pj.speed;
          if (pj.x > 620) {
            pj.x = -50;
          }
          break;

        case 3:
        pj.x -= pj.speed;
          if (pj.x < -50) {
            pj.x = 620;
          }
          break;

        default:
        pj.x += 0;
        pj.y += 0;
          break;
      }
      }
     
      repaint();
      window.requestAnimationFrame(update);
    }

    function repaint() {
      ctx.fillStyle = "aliceblue";
      ctx.fillRect(0, 0, 1000, 1000);
    // ctx.fillStyle = random_rgba();
    // ctx.fillRect(x, y, 40, 40);
    pared01.pintar(ctx);
    pared01.playerCollider(pj);

    pared02.pintar(ctx);
    pared02.playerCollider(pj);

    if(bonito.playerCollider(pj)){
        bonito.randompos();
        score += 1;
    }
    bonito.pintar(ctx);
    pj.pintar(ctx);

    if(pausa){
      ctx.fillStyle = "rgb(214, 214, 214, 0.8)";
      ctx.fillRect(0, 0, 1000, 1000);
      ctx.fillStyle = "black";
      ctx.font = "30px Arial";
      ctx.fillText("PAUSA", 250, 299);
    }
    ctx.fillStyle = "black";
      ctx.font = "30px Arial";
      ctx.fillText("Score: " + score, 5,30);
    }
  </script>
</html>
